import pandas as pd
import numpy as np
from scipy import stats
import seaborn as sns
import matplotlib.pyplot as plt

# Искусственное создание данных (замените на реальные данные)
data = {
    'X': [
        'было все равно, что изучать',
        'записался по рекомендации учителя',
        'записался за компанию с друзьями',
        'записался по рекомендации друзей',
        'записался по рекомендации родителей',
        'записался по собственному желанию'
    ] * 50,
    'Y': np.random.randint(0, 6, size=300)  # Оценки от 0 до 5
}

df = pd.DataFrame(data)

# Вывод первых строк DataFrame
print(df.head())

# 1. Анализ средних значений Y для каждой категории X
mean_analysis = df.groupby('X')['Y'].mean().reset_index()
print("\nСредние значения Y по категориям X:")
print(mean_analysis)

# 2. Визуализация распределения Y по категориям X
plt.figure(figsize=(10, 6))
sns.boxplot(x='X', y='Y', data=df)
plt.title('Распределение оценок Y по причинам выбора программы X')
plt.xticks(rotation=45)
plt.show()

# 3. Проверка статистической значимости различий между группами
# Если нужно сравнить две группы, используем t-тест
# Если больше двух групп, используем ANOVA

# Пример: Сравнение двух групп (например, "было все равно" и "по рекомендации учителя")
group1 = df[df['X'] == 'было все равно, что изучать']['Y']
group2 = df[df['X'] == 'записался по рекомендации учителя']['Y']

t_stat, p_value = stats.ttest_ind(group1, group2, equal_var=False)
print(f"\nT-тест между двумя группами:")
print(f"T-статистика: {t_stat}")
print(f"P-значение: {p_value}")

# Если нужно сравнить все группы, используем ANOVA
f_stat, p_value_anova = stats.f_oneway(
    df[df['X'] == 'было все равно, что изучать']['Y'],
    df[df['X'] == 'записался по рекомендации учителя']['Y'],
    df[df['X'] == 'записался за компанию с друзьями']['Y'],
    df[df['X'] == 'записался по рекомендации друзей']['Y'],
    df[df['X'] == 'записался по рекомендации родителей']['Y'],
    df[df['X'] == 'записался по собственному желанию']['Y']
)
print("\nANOVA для всех групп:")
print(f"F-статистика: {f_stat}")
print(f"P-значение: {p_value_anova}")

# Интерпретация результатов:
# Если P < 0.05, то различия между группами статистически значимы

# Искусственное создание данных (замените на реальные данные)
data = {
    'X': [
        'не знал (не знала), что практические занятия проводятся',
        'не посещал (не посещала)',
        'иногда посещал (посещала) и было не интересно',
        'посещал (посещала) не всегда, занятия были интересны',
        'никогда не пропускал, на занятиях было интересно'
    ] * 60,
    'Y': np.random.randint(0, 6, size=300)  # Оценки от 0 до 5
}

df = pd.DataFrame(data)

# Вывод первых строк DataFrame
print(df.head())

# 1. Анализ средних значений Y для каждой категории X
mean_analysis = df.groupby('X')['Y'].mean().reset_index()
print("\nСредние значения Y по категориям X:")
print(mean_analysis)

# 2. Визуализация распределения Y по категориям X
plt.figure(figsize=(12, 6))
sns.boxplot(x='X', y='Y', data=df)
plt.title('Распределение оценок Y по категориям посещаемости занятий X')
plt.xticks(rotation=90)
plt.show()

# 3. Проверка статистической значимости различий между группами
# Используем ANOVA для сравнения более чем двух групп
f_stat, p_value_anova = stats.f_oneway(
    df[df['X'] == 'не знал (не знала), что практические занятия проводятся']['Y'],
    df[df['X'] == 'не посещал (не посещала)']['Y'],
    df[df['X'] == 'иногда посещал (посещала) и было не интересно']['Y'],
    df[df['X'] == 'посещал (посещала) не всегда, занятия были интересны']['Y'],
    df[df['X'] == 'никогда не пропускал, на занятиях было интересно']['Y']
)
print("\nANOVA для всех групп:")
print(f"F-статистика: {f_stat}")
print(f"P-значение: {p_value_anova}")

# Интерпретация результатов:
# Если P < 0.05, то различия между группами статистически значимы

# Генерация данных с зависимостью
np.random.seed(42)  # Для воспроизводимости

# Категории посещаемости
categories = [
    'не знал (не знала), что практические занятия проводятся',
    'не посещал (не посещала)',
    'иногда посещал (посещала) и было не интересно',
    'посещал (посещала) не всегда, занятия были интересны',
    'никогда не пропускал, на занятиях было интересно'
]

# Создание датафрейма
data = {
    'X': categories * 60,
    'Y': []  # Пустой список для оценок
}

# Генерация оценок с зависимостью от категории
for category in categories:
    if category == categories[0]:  # "не знал"
        data['Y'].extend(np.random.randint(0, 2, size=60))  # Низкие оценки
    elif category == categories[1]:  # "не посещал"
        data['Y'].extend(np.random.randint(0, 3, size=60))  # Средние низкие оценки
    elif category == categories[2]:  # "иногда посещал"
        data['Y'].extend(np.random.randint(1, 4, size=60))  # Средние оценки
    elif category == categories[3]:  # "посещал не всегда"
        data['Y'].extend(np.random.randint(2, 5, size=60))  # Средние высокие оценки
    elif category == categories[4]:  # "никогда не пропускал"
        data['Y'].extend(np.random.randint(3, 6, size=60))  # Высокие оценки

df = pd.DataFrame(data)

# Преобразование X в порядковую шкалу
order_mapping = {
    'не знал (не знала), что практические занятия проводятся': 1,
    'не посещал (не посещала)': 2,
    'иногда посещал (посещала) и было не интересно': 3,
    'посещал (посещала) не всегда, занятия были интересны': 4,
    'никогда не пропускал, на занятиях было интересно': 5
}
df['X_Ordered'] = df['X'].map(order_mapping)

# Корреляционный анализ с использованием коэффициента Спирмана
rho, p_value = stats.spearmanr(df['X_Ordered'], df['Y'])
print(f"Коэффициент Спирмана (ρ): {rho}")
print(f"P-значение: {p_value}")

# Интерпретация:
if p_value < 0.05:
    print("Связь между переменными статистически значима.")
else:
    print("Связь между переменными не является статистически значимой.")

# Визуализация: Диаграмма рассеяния
plt.figure(figsize=(8, 6))
sns.scatterplot(x='X_Ordered', y='Y', data=df)
plt.title('Диаграмма рассеяния: Посещаемость занятий vs Впечатление от программы')
plt.xlabel('Посещаемость занятий (порядковая шкала)')
plt.ylabel('Впечатление от программы (оценка от 0 до 5)')
plt.show()

# Визуализация: Бокс-плот
plt.figure(figsize=(10, 6))
sns.boxplot(x='X', y='Y', data=df)
plt.title('Распределение впечатлений от программы по категориям посещаемости занятий')
plt.xticks(rotation=90)
plt.show()
